{% extends "ui/base.html" %}
{% block title %}è£ç½®è³‡è¨Š{% endblock %}
{% block header %}è£ç½®è³‡è¨Š{% endblock %}

{% block content %}
<div class="card" style="max-width:640px;">
  <div style="margin-bottom:12px;">
      <div><strong>åºè™Ÿï¼š</strong> {{ info.serial }}</div>
      <div>
        <strong>è£ç½®å¯†ç¢¼ï¼š</strong>
        {% if info.has_password %}
          <span id="devicePassword"
                data-password="{{ info.password }}"
                data-masked="{{ info.masked_password }}">{{ info.masked_password }}</span>
          <button type="button"
                  id="togglePassword"
                  aria-label="é¡¯ç¤ºè£ç½®å¯†ç¢¼"
                  style="margin-left:8px; border:none; background:none; cursor:pointer; font-size:16px;">
            <span id="togglePasswordIcon">ğŸ‘</span>
          </button>
        {% else %}
          <span>æœªè¨­å®š</span>
        {% endif %}
      </div>
      <div><strong>ç‰ˆæœ¬ï¼š</strong> {{ info.version }}</div>
      <div><strong>é€£æ¥ç‹€æ…‹ï¼š</strong>
        {% if info.status == 1 %}
          <span style="color:green; font-weight:bold;">True</span>
        {% else %}
          <span style="color:red; font-weight:bold;">False</span>
        {% endif %}
      </div>
  </div>

  <!-- ç”¢ç”Ÿ QR çš„æŒ‰éˆ•èˆ‡å€å¡Š -->
  <div style="margin-top:16px;">
    <button id="btnToggleQR" class="btn">é¡¯ç¤º QRCode</button>
    &nbsp;
    
  </div>

  <div id="qrWrap" style="margin-top:12px; display:none;">
    {% if qrcode_data %}
      <img id="deviceQrImg" src="{{ qrcode_data }}" alt="device qrcode" style="width:320px; height:320px; border:1px solid rgba(0,0,0,0.08); box-shadow:0 6px 18px rgba(0,0,0,0.06);">
    {% else %}
      <p style="color: #c00;">QRCode ç„¡æ³•ç”¢ç”Ÿã€‚</p>
    {% endif %}
  </div>
</div>

<script>
(function(){
  const btn = document.getElementById("btnToggleQR");
  const wrap = document.getElementById("qrWrap");
  const img = document.getElementById("deviceQrImg");
  const dl = document.getElementById("downloadQr");
  const togglePasswordBtn = document.getElementById("togglePassword");
  const passwordSpan = document.getElementById("devicePassword");
  const passwordIcon = document.getElementById("togglePasswordIcon");

  btn.addEventListener("click", function(){
    if (!wrap) return;
    if (wrap.style.display === "none" || wrap.style.display === "") {
      wrap.style.display = "block";
      btn.textContent = "éš±è— QRCode";
      if (img && dl) {
        // è¨­å®š download é€£çµç‚º base64 è³‡æ–™
        dl.href = img.src;
        dl.style.display = "inline-block";
      }
    } else {
      wrap.style.display = "none";
      btn.textContent = "é¡¯ç¤º QRCode";
      if (dl) dl.style.display = "none";
    }
  });

  if (togglePasswordBtn && passwordSpan) {
    let isRevealed = false;
    const masked = passwordSpan.dataset.masked || "";
    const actual = passwordSpan.dataset.password || "";

    passwordSpan.textContent = masked || "æœªè¨­å®š";

    togglePasswordBtn.addEventListener("click", function () {
      if (!actual) return;
      isRevealed = !isRevealed;
      passwordSpan.textContent = isRevealed ? actual : (masked || "æœªè¨­å®š");
      if (passwordIcon) {
        passwordIcon.textContent = isRevealed ? "ğŸ™ˆ" : "ğŸ‘";
        togglePasswordBtn.setAttribute(
          "aria-label",
          isRevealed ? "éš±è—è£ç½®å¯†ç¢¼" : "é¡¯ç¤ºè£ç½®å¯†ç¢¼"
        );
      }
    });
  }
})();
</script>
{% endblock %}
